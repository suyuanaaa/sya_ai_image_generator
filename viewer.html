<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI 图片展示</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #111;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
      position: relative;
    }

    video#bg-video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }

    img#display-image {
      max-width: 90%;
      max-height: 90%;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      z-index: 1;
      display: none;
      position: relative;
    }

    #debug-text {
      color: white;
      position: absolute;
      bottom: 10px;
      z-index: 2;
      font-size: 14px;
    }
  </style>
</head>
<body>

<video id="bg-video" autoplay loop muted playsinline>
  <source src="/sya_ai_image_generator/assets/testvideo.mp4" type="video/mp4" />
  你的浏览器不支持 HTML5 视频
</video>

<img id="display-image" src="" alt="等待接收图片..." />
<p id="debug-text">⏳ 正在等待图片...</p>

<script>
  console.log("✅ viewer.html 脚本已加载");

  const JSONBIN_API_KEY = "$2a$10$rPcjYa2JskbTj..4LxWai.DJWt2TW9A7Uc54eSZFfBY3jDcN5zLiO";
  const JSONBIN_URL = "https://api.jsonbin.io/v3/b/686e98cb73529642b377cf2f/latest";

  const updateImage = async () => {
    try {
      const response = await fetch(JSONBIN_URL, {
        headers: {
          "X-Master-Key": JSONBIN_API_KEY
        }
      });
      const result = await response.json();

      console.log("✅ JSONBin 返回内容：", result);

      const record = result?.record;
      const url = record?.currentImage;

      if (url) {
        const imageElement = document.getElementById("display-image");
        imageElement.onload = () => {
          imageElement.style.display = "block";
          document.getElementById("bg-video").style.display = "none";
        };
        imageElement.src = url;
        document.getElementById("debug-text").textContent = "✅ 图片已加载";
      } else {
        document.getElementById("debug-text").textContent = "⚠️ 没有读取到图片链接";
      }

    } catch (err) {
      console.error("❌ 获取图片失败：", err);
      document.getElementById("debug-text").textContent = "❌ 获取失败：" + err.message;
    }
  };

  updateImage();
  setInterval(updateImage, 3000);
</script>
</body>
</html>
